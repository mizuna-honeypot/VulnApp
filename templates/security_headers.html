{% extends "base.html" %}

{% block title %}Security Headers æ¬ å¦‚ - VulnApp{% endblock %}

{% block content %}
<div class="container">
        <h1>ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼æ¬ å¦‚ (A05:2021)</h1>
        <p class="description">
            ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€VulnAppã«æ„å›³çš„ã«<strong>è¨­å®šã—ã¦ã„ãªã„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼</strong>ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚
            ã“ã‚Œã‚‰ã®HTTPãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã¯ã€æ§˜ã€…ãªæ”»æ’ƒã‹ã‚‰Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¿è­·ã™ã‚‹ãŸã‚ã«é‡è¦ã§ã™ã€‚
        </p>

        <div class="warning-box">
            <h3>âš ï¸ é‡è¦ãªè­¦å‘Š</h3>
            <p>
                ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯<strong>æ„å›³çš„ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®šã—ã¦ã„ã¾ã›ã‚“</strong>ã€‚
                å®Ÿéš›ã®æœ¬ç•ªç’°å¢ƒã§ã¯ã€ã™ã¹ã¦ã®æ¨å¥¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’é©åˆ‡ã«è¨­å®šã—ã¦ãã ã•ã„ã€‚
            </p>
        </div>

        <!-- ç¾åœ¨ã®çŠ¶æ…‹ -->
        <h2>ğŸ“Š VulnAppã®ç¾åœ¨ã®çŠ¶æ…‹</h2>
        <table class="comparison-table">
            <thead>
                <tr>
                    <th>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼</th>
                    <th>çŠ¶æ…‹</th>
                    <th>å½±éŸ¿</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>X-Frame-Options</td>
                    <td class="status-missing">âŒ æœªè¨­å®š</td>
                    <td>Clickjackingæ”»æ’ƒã«è„†å¼±</td>
                </tr>
                <tr>
                    <td>Content-Security-Policy (CSP)</td>
                    <td class="status-missing">âŒ æœªè¨­å®š</td>
                    <td>XSSæ”»æ’ƒã«è„†å¼±</td>
                </tr>
                <tr>
                    <td>X-Content-Type-Options</td>
                    <td class="status-missing">âŒ æœªè¨­å®š</td>
                    <td>MIME Type Sniffingæ”»æ’ƒã«è„†å¼±</td>
                </tr>
                <tr>
                    <td>Strict-Transport-Security (HSTS)</td>
                    <td class="status-missing">âŒ æœªè¨­å®š</td>
                    <td>Man-in-the-Middleæ”»æ’ƒã«è„†å¼±</td>
                </tr>
                <tr>
                    <td>X-XSS-Protection</td>
                    <td class="status-missing">âŒ æœªè¨­å®š</td>
                    <td>XSSæ”»æ’ƒã«è„†å¼±ï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ãƒ–ãƒ©ã‚¦ã‚¶ï¼‰</td>
                </tr>
                <tr>
                    <td>Referrer-Policy</td>
                    <td class="status-missing">âŒ æœªè¨­å®š</td>
                    <td>Refereræƒ…å ±æ¼æ´©</td>
                </tr>
                <tr>
                    <td>Permissions-Policy</td>
                    <td class="status-missing">âŒ æœªè¨­å®š</td>
                    <td>ä¸è¦ãªæ©Ÿèƒ½ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯</td>
                </tr>
            </tbody>
        </table>

        <!-- å„ãƒ˜ãƒƒãƒ€ãƒ¼ã®è©³ç´° -->
        <h2>ğŸ“‹ å„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è©³ç´°</h2>

        <!-- X-Frame-Options -->
        <div class="header-card">
            <h3>
                ğŸ–¼ï¸ X-Frame-Options
                <span class="severity-badge severity-high">HIGH</span>
            </h3>
            <div class="header-info">
                <p><strong>ç›®çš„:</strong> Clickjackingæ”»æ’ƒã®é˜²æ­¢</p>
                <p><strong>ç¾åœ¨ã®çŠ¶æ…‹:</strong> æœªè¨­å®šï¼ˆå…¨ãƒšãƒ¼ã‚¸ã§iframeåŸ‹ã‚è¾¼ã¿å¯èƒ½ï¼‰</p>
            </div>
            <h4>âš ï¸ ãƒªã‚¹ã‚¯</h4>
            <ul class="risk-list">
                <li>æ‚ªæ„ã®ã‚ã‚‹ã‚µã‚¤ãƒˆãŒVulnAppã‚’iframeã§åŸ‹ã‚è¾¼ã¿å¯èƒ½</li>
                <li>é€æ˜ãªãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’ä½¿ç”¨ã—ãŸã‚¯ãƒªãƒƒã‚¯èª˜å°æ”»æ’ƒ</li>
                <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ„å›³ã—ãªã„æ“ä½œã‚’å®Ÿè¡Œã•ã›ã‚‰ã‚Œã‚‹</li>
            </ul>
            <h4>âœ… æ¨å¥¨è¨­å®š</h4>
            <div class="code-block">X-Frame-Options: DENY
# ã¾ãŸã¯
X-Frame-Options: SAMEORIGIN</div>
        </div>

        <!-- Content-Security-Policy -->
        <div class="header-card">
            <h3>
                ğŸ”’ Content-Security-Policy (CSP)
                <span class="severity-badge severity-high">HIGH</span>
            </h3>
            <div class="header-info">
                <p><strong>ç›®çš„:</strong> XSSæ”»æ’ƒã¨ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æ”»æ’ƒã®é˜²æ­¢</p>
                <p><strong>ç¾åœ¨ã®çŠ¶æ…‹:</strong> æœªè¨­å®šï¼ˆä»»æ„ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œå¯èƒ½ï¼‰</p>
            </div>
            <h4>âš ï¸ ãƒªã‚¹ã‚¯</h4>
            <ul class="risk-list">
                <li>ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ç„¡åˆ¶é™å®Ÿè¡Œ</li>
                <li>å¤–éƒ¨ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆèª­ã¿è¾¼ã¿</li>
                <li>eval()ç­‰ã®å±é™ºãªé–¢æ•°ã®ä½¿ç”¨</li>
            </ul>
            <h4>âœ… æ¨å¥¨è¨­å®š</h4>
            <div class="code-block">Content-Security-Policy: default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data:</div>
        </div>

        <!-- X-Content-Type-Options -->
        <div class="header-card">
            <h3>
                ğŸ“„ X-Content-Type-Options
                <span class="severity-badge severity-medium">MEDIUM</span>
            </h3>
            <div class="header-info">
                <p><strong>ç›®çš„:</strong> MIME Type Sniffingæ”»æ’ƒã®é˜²æ­¢</p>
                <p><strong>ç¾åœ¨ã®çŠ¶æ…‹:</strong> æœªè¨­å®šï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ãŒMIME Typeã‚’æ¨æ¸¬ï¼‰</p>
            </div>
            <h4>âš ï¸ ãƒªã‚¹ã‚¯</h4>
            <ul class="risk-list">
                <li>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ãŒJavaScriptã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã‚‹å¯èƒ½æ€§</li>
                <li>Content-Typeãƒ˜ãƒƒãƒ€ãƒ¼ã®ç„¡è¦–ã«ã‚ˆã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚¤ãƒ‘ã‚¹</li>
            </ul>
            <h4>âœ… æ¨å¥¨è¨­å®š</h4>
            <div class="code-block">X-Content-Type-Options: nosniff</div>
        </div>

        <!-- Strict-Transport-Security -->
        <div class="header-card">
            <h3>
                ğŸ” Strict-Transport-Security (HSTS)
                <span class="severity-badge severity-high">HIGH</span>
            </h3>
            <div class="header-info">
                <p><strong>ç›®çš„:</strong> HTTPSæ¥ç¶šã®å¼·åˆ¶ã¨Man-in-the-Middleæ”»æ’ƒã®é˜²æ­¢</p>
                <p><strong>ç¾åœ¨ã®çŠ¶æ…‹:</strong> æœªè¨­å®šï¼ˆHTTPæ¥ç¶šãŒè¨±å¯ã•ã‚Œã‚‹ï¼‰</p>
            </div>
            <h4>âš ï¸ ãƒªã‚¹ã‚¯</h4>
            <ul class="risk-list">
                <li>åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã®HTTPé€šä¿¡ãŒå‚å—ã•ã‚Œã‚‹å¯èƒ½æ€§</li>
                <li>SSLã‚¹ãƒˆãƒªãƒƒãƒ”ãƒ³ã‚°æ”»æ’ƒã«è„†å¼±</li>
                <li>ä¸­é–“è€…æ”»æ’ƒã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿ç›—è´</li>
            </ul>
            <h4>âœ… æ¨å¥¨è¨­å®š</h4>
            <div class="code-block">Strict-Transport-Security: max-age=31536000; includeSubDomains; preload</div>
        </div>

        <!-- X-XSS-Protection -->
        <div class="header-card">
            <h3>
                ğŸ›¡ï¸ X-XSS-Protection
                <span class="severity-badge severity-medium">MEDIUM</span>
            </h3>
            <div class="header-info">
                <p><strong>ç›®çš„:</strong> ãƒ–ãƒ©ã‚¦ã‚¶å†…è”µã®XSSãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã®æœ‰åŠ¹åŒ–ï¼ˆãƒ¬ã‚¬ã‚·ãƒ¼ï¼‰</p>
                <p><strong>ç¾åœ¨ã®çŠ¶æ…‹:</strong> æœªè¨­å®š</p>
            </div>
            <h4>âš ï¸ ãƒªã‚¹ã‚¯</h4>
            <ul class="risk-list">
                <li>å¤ã„ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®XSSæ”»æ’ƒã«å¯¾ã™ã‚‹ä¿è­·ãªã—</li>
            </ul>
            <h4>âœ… æ¨å¥¨è¨­å®š</h4>
            <div class="code-block">X-XSS-Protection: 1; mode=block</div>
            <p><small>â€» ç¾ä»£ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯CSPãŒæ¨å¥¨ã•ã‚Œã¾ã™</small></p>
        </div>

        <!-- Referrer-Policy -->
        <div class="header-card">
            <h3>
                ğŸ”— Referrer-Policy
                <span class="severity-badge severity-medium">MEDIUM</span>
            </h3>
            <div class="header-info">
                <p><strong>ç›®çš„:</strong> Refereræƒ…å ±ã®æ¼æ´©é˜²æ­¢</p>
                <p><strong>ç¾åœ¨ã®çŠ¶æ…‹:</strong> æœªè¨­å®šï¼ˆå®Œå…¨ãªURLãŒé€ä¿¡ã•ã‚Œã‚‹ï¼‰</p>
            </div>
            <h4>âš ï¸ ãƒªã‚¹ã‚¯</h4>
            <ul class="risk-list">
                <li>URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«å«ã¾ã‚Œã‚‹æ©Ÿå¯†æƒ…å ±ã®æ¼æ´©</li>
                <li>ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³ã‚„APIã‚­ãƒ¼ã®éœ²å‡º</li>
            </ul>
            <h4>âœ… æ¨å¥¨è¨­å®š</h4>
            <div class="code-block">Referrer-Policy: strict-origin-when-cross-origin</div>
        </div>

        <!-- Permissions-Policy -->
        <div class="header-card">
            <h3>
                ğŸ›ï¸ Permissions-Policy
                <span class="severity-badge severity-medium">MEDIUM</span>
            </h3>
            <div class="header-info">
                <p><strong>ç›®çš„:</strong> ãƒ–ãƒ©ã‚¦ã‚¶æ©Ÿèƒ½ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡</p>
                <p><strong>ç¾åœ¨ã®çŠ¶æ…‹:</strong> æœªè¨­å®šï¼ˆã™ã¹ã¦ã®æ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ï¼‰</p>
            </div>
            <h4>âš ï¸ ãƒªã‚¹ã‚¯</h4>
            <ul class="risk-list">
                <li>ã‚«ãƒ¡ãƒ©ã€ãƒã‚¤ã‚¯ç­‰ã¸ã®ä¸è¦ãªã‚¢ã‚¯ã‚»ã‚¹è¨±å¯</li>
                <li>ä½ç½®æƒ…å ±ã®å–å¾—</li>
            </ul>
            <h4>âœ… æ¨å¥¨è¨­å®š</h4>
            <div class="code-block">Permissions-Policy: geolocation=(), microphone=(), camera=()</div>
        </div>

        <!-- æ¤œè¨¼æ–¹æ³• -->
        <h2>ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®ç¢ºèªæ–¹æ³•</h2>
        <div class="test-section">
            <h4>1. ãƒ–ãƒ©ã‚¦ã‚¶é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«</h4>
            <ol>
                <li>F12ã‚­ãƒ¼ã§é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã‚’é–‹ã</li>
                <li>ã€ŒNetworkã€ã‚¿ãƒ–ã‚’é¸æŠ</li>
                <li>ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰</li>
                <li>æœ€åˆã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯</li>
                <li>ã€ŒHeadersã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã€ŒResponse Headersã€ã‚’ç¢ºèª</li>
            </ol>

            <h4>2. curlã‚³ãƒãƒ³ãƒ‰</h4>
            <div class="code-block">curl -I http://54.65.251.49/</div>

            <h4>3. ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ„ãƒ¼ãƒ«</h4>
            <ul>
                <li><a href="https://securityheaders.com/" target="_blank">SecurityHeaders.com</a></li>
                <li><a href="https://observatory.mozilla.org/" target="_blank">Mozilla Observatory</a></li>
            </ul>
        </div>

        <!-- Flaskå®Ÿè£…ä¾‹ -->
        <h2>ğŸ’» Flaskã§ã®å®Ÿè£…ä¾‹</h2>
        <div class="success-box">
            <h3>âœ… ã‚»ã‚­ãƒ¥ã‚¢ãªå®Ÿè£…æ–¹æ³•</h3>
            <p>æœ¬ç•ªç’°å¢ƒã§ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ï¼š</p>
        </div>
        <div class="code-block">from flask import Flask, make_response

app = Flask(__name__)

@app.after_request
def set_security_headers(response):
    # Clickjackingå¯¾ç­–
    response.headers['X-Frame-Options'] = 'DENY'
    
    # XSSå¯¾ç­–
    response.headers['Content-Security-Policy'] = "default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'"
    
    # MIME Sniffingå¯¾ç­–
    response.headers['X-Content-Type-Options'] = 'nosniff'
    
    # HTTPSå¼·åˆ¶ï¼ˆHTTPSä½¿ç”¨æ™‚ã®ã¿ï¼‰
    # response.headers['Strict-Transport-Security'] = 'max-age=31536000; includeSubDomains'
    
    # ãƒ¬ã‚¬ã‚·ãƒ¼XSSä¿è­·
    response.headers['X-XSS-Protection'] = '1; mode=block'
    
    # Refereråˆ¶å¾¡
    response.headers['Referrer-Policy'] = 'strict-origin-when-cross-origin'
    
    # æ©Ÿèƒ½åˆ¶é™
    response.headers['Permissions-Policy'] = 'geolocation=(), microphone=(), camera=()'
    
    return response</div>

        <!-- ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ -->
        <div class="success-box">
            <h3>ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹</h3>
            <ul>
                <li>ã™ã¹ã¦ã®æ¨å¥¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®šã™ã‚‹</li>
                <li>CSPã¯æ®µéšçš„ã«å³æ ¼åŒ–ã™ã‚‹ï¼ˆReport-Onlyãƒ¢ãƒ¼ãƒ‰ã‚’æ´»ç”¨ï¼‰</li>
                <li>HSTSã¯ãƒ†ã‚¹ãƒˆå¾Œã«max-ageã‚’é•·ãã™ã‚‹</li>
                <li>å®šæœŸçš„ã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨­å®šã‚’è¦‹ç›´ã™</li>
                <li>WAFï¼ˆWeb Application Firewallï¼‰ã®å°å…¥ã‚‚æ¤œè¨ã™ã‚‹</li>
                <li>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ãƒ„ãƒ¼ãƒ«ã§å®šæœŸçš„ã«æ¤œè¨¼ã™ã‚‹</li>
            </ul>
        </div>

        <a href="/" class="back-link">â† ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹</a>
    </div>

<style>
.header-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .header-card h3 {
            color: #e74c3c;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .severity-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: bold;
        }
        .severity-high {
            background-color: #e74c3c;
            color: white;
        }
        .severity-medium {
            background-color: #f39c12;
            color: white;
        }
        .header-info {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .header-info strong {
            color: #2c3e50;
        }
        .risk-list {
            list-style: none;
            padding-left: 0;
        }
        .risk-list li {
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        .risk-list li:last-child {
            border-bottom: none;
        }
        .risk-list li::before {
            content: "âš ï¸ ";
            margin-right: 8px;
        }
        .warning-box {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .warning-box h3 {
            color: #856404;
            margin-top: 0;
        }
        .success-box {
            background-color: #d4edda;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .success-box h3 {
            color: #155724;
            margin-top: 0;
        }
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
            font-family: monospace;
            margin: 10px 0;
            font-size: 0.9em;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .comparison-table th,
        .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background-color: #3498db;
            color: white;
        }
        .comparison-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .status-missing {
            color: #e74c3c;
            font-weight: bold;
        }
        .status-present {
            color: #27ae60;
            font-weight: bold;
        }
        .back-link {
            display: inline-block;
            margin-top: 20px;
            color: #3498db;
            text-decoration: none;
        }
        .back-link:hover {
            text-decoration: underline;
        }
        .test-section {
            background: #e8f4f8;
            padding: 15px;
            border-left: 4px solid #3498db;
            margin: 15px 0;
        }
</style>
{% endblock %}
