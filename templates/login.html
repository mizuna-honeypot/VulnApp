{% extends "base.html" %}

{% block title %}ãƒ­ã‚°ã‚¤ãƒ³ - CSRF ãƒ‡ãƒ¢{% endblock %}

{% block content %}
<div class="vuln-demo">
    <h2>ğŸ” ãƒ­ã‚°ã‚¤ãƒ³ (CSRF ã®ãƒ‡ãƒ¢)</h2>
    
    <div class="warning-box">
        <h3>âš ï¸ è„†å¼±æ€§: CSRF (Cross-Site Request Forgery) (A01:2021)</h3>
        <p>ã“ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ ã¯æ„å›³çš„ã«CSRFï¼ˆã‚¯ãƒ­ã‚¹ã‚µã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ•ã‚©ãƒ¼ã‚¸ã‚§ãƒªï¼‰ã®è„†å¼±æ€§ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚</p>
    </div>

    <div class="demo-section">
        <h3>ãƒ­ã‚°ã‚¤ãƒ³</h3>
        <form method="POST" action="/login" class="login-form">
            <div class="form-group">
                <label for="username">ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</label>
                <input type="text" id="username" name="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›" required>
            </div>
            <div class="form-group">
                <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:</label>
                <input type="password" id="password" name="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" required>
            </div>
            <button type="submit" class="btn">ãƒ­ã‚°ã‚¤ãƒ³</button>
        </form>
    </div>

    <div class="demo-section">
        <h3>ğŸ’¡ CSRFæ”»æ’ƒã®ã‚·ãƒŠãƒªã‚ª</h3>
        <ul class="payload-list">
            <li>æ”»æ’ƒè€…ãŒæ‚ªæ„ã®ã‚ã‚‹HTMLãƒšãƒ¼ã‚¸ã‚’ä½œæˆ</li>
            <li>è¢«å®³è€…ãŒãã®ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹</li>
            <li>éš ã—ãƒ•ã‚©ãƒ¼ãƒ ãŒè‡ªå‹•é€ä¿¡ã•ã‚Œã€è¢«å®³è€…ã®æ¨©é™ã§ä¸æ­£ãªæ“ä½œãŒå®Ÿè¡Œã•ã‚Œã‚‹</li>
            <li>CSRFãƒˆãƒ¼ã‚¯ãƒ³ãŒãªã„ãŸã‚ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æ­£å½“æ€§ã‚’æ¤œè¨¼ã§ããªã„</li>
        </ul>
    </div>

    {% if success %}
    <div class="result-section success">
        <h3>âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ</h3>
        <p>ã‚ˆã†ã“ãã€<strong>{{ username }}</strong> ã•ã‚“ï¼</p>
        <p>ã“ã®ãƒ•ã‚©ãƒ¼ãƒ ã«ã¯CSRFä¿è­·ãŒãªã„ãŸã‚ã€æ”»æ’ƒè€…ãŒä»»æ„ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã§ãã¾ã™ã€‚</p>
    </div>
    {% endif %}

    <div class="demo-section">
        <h3>ğŸ“– æŠ€è¡“çš„ãªèª¬æ˜</h3>
        <div class="code-block">
            <h4>è„†å¼±ãªã‚³ãƒ¼ãƒ‰:</h4>
            <pre>&lt;form method="POST" action="/login"&gt;
    &lt;!-- CSRFãƒˆãƒ¼ã‚¯ãƒ³ãªã— --&gt;
    &lt;input type="text" name="username"&gt;
    &lt;input type="password" name="password"&gt;
    &lt;button type="submit"&gt;ãƒ­ã‚°ã‚¤ãƒ³&lt;/button&gt;
&lt;/form&gt;</pre>
            <p>CSRFãƒˆãƒ¼ã‚¯ãƒ³ãŒãªã„ãŸã‚ã€å¤–éƒ¨ã‚µã‚¤ãƒˆã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¤œè¨¼ã§ãã¾ã›ã‚“ã€‚</p>
        </div>
        <div class="code-block">
            <h4>å®‰å…¨ãªã‚³ãƒ¼ãƒ‰:</h4>
            <pre>&lt;form method="POST" action="/login"&gt;
    &lt;!-- CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿½åŠ  --&gt;
    &lt;input type="hidden" name="csrf_token" value="{% raw %}{{ csrf_token() }}{% endraw %}"&gt;
    &lt;input type="text" name="username"&gt;
    &lt;input type="password" name="password"&gt;
    &lt;button type="submit"&gt;ãƒ­ã‚°ã‚¤ãƒ³&lt;/button&gt;
&lt;/form&gt;</pre>
            <p>ã‚µãƒ¼ãƒãƒ¼å´ã§CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’æ¤œè¨¼ã™ã‚‹ã“ã¨ã§ã€å¤–éƒ¨ã‚µã‚¤ãƒˆã‹ã‚‰ã®ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é˜²ãã¾ã™ã€‚</p>
        </div>
        <p>Flask-WTFãªã©ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€CSRFãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆã¨æ¤œè¨¼ã‚’ç°¡å˜ã«å®Ÿè£…ã§ãã¾ã™ã€‚</p>
    </div>
</div>

<style>
.vuln-demo {
    max-width: 900px;
    margin: 0 auto;
}

.warning-box {
    background-color: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: 5px;
    padding: 15px;
    margin: 20px 0;
}

.demo-section {
    background-color: #f8f9fa;
    border-radius: 5px;
    padding: 20px;
    margin: 20px 0;
}

.login-form {
    display: flex;
    flex-direction: column;
    gap: 15px;
    max-width: 400px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.form-group label {
    font-weight: bold;
    color: #333;
}

.form-group input[type="text"],
.form-group input[type="password"] {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
    font-family: inherit;
}

.payload-list {
    list-style: none;
    padding: 0;
}

.payload-list li {
    background-color: #fff;
    border-left: 4px solid #007bff;
    padding: 10px;
    margin: 10px 0;
}

.result-section {
    background-color: #d4edda;
    border: 2px solid #28a745;
    border-radius: 5px;
    padding: 20px;
    margin: 20px 0;
}

.result-section h3 {
    color: #155724;
    margin-top: 0;
}

.code-block {
    background-color: #fff;
    border-left: 4px solid #28a745;
    padding: 15px;
    margin: 15px 0;
}

.code-block pre {
    background-color: #f4f4f4;
    padding: 10px;
    border-radius: 4px;
    overflow-x: auto;
    font-family: monospace;
    font-size: 14px;
    margin: 10px 0;
}

.code-block code {
    background-color: #f4f4f4;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: monospace;
}
</style>
{% endblock %}
