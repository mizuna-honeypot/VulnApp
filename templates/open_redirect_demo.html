{% extends "base.html" %}

{% block title %}ã‚ªãƒ¼ãƒ—ãƒ³ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã®ãƒ‡ãƒ¢{% endblock %}

{% block content %}
<div class="vuln-demo">
    <h2>ğŸ”— ã‚ªãƒ¼ãƒ—ãƒ³ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ (Open Redirect) ã®ãƒ‡ãƒ¢</h2>
    
    <div class="warning-box">
        <h3>âš ï¸ è„†å¼±æ€§: ã‚ªãƒ¼ãƒ—ãƒ³ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ</h3>
        <p>ã“ã®æ©Ÿèƒ½ã¯æ„å›³çš„ã«ã‚ªãƒ¼ãƒ—ãƒ³ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã®è„†å¼±æ€§ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚</p>
        <p>æ”»æ’ƒè€…ã¯æ­£è¦ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’åˆ©ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ‚ªæ„ã®ã‚ã‚‹ã‚µã‚¤ãƒˆã¸èª˜å°ã§ãã¾ã™ã€‚</p>
    </div>

    <div class="demo-section">
        <h3>ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ©Ÿèƒ½</h3>
        <p>ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€æŒ‡å®šã•ã‚ŒãŸURLã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™ã€‚</p>
        
        <div class="link-examples">
            <h4>å®‰å…¨ãªä¾‹ï¼ˆå†…éƒ¨ãƒªãƒ³ã‚¯ï¼‰:</h4>
            <ul>
                <li><a href="/redirect?url=/products" class="safe-link">å•†å“ä¸€è¦§ã¸</a></li>
                <li><a href="/redirect?url=/product/1" class="safe-link">å•†å“è©³ç´°ã¸</a></li>
            </ul>

            <h4>âš ï¸ å±é™ºãªä¾‹ï¼ˆå¤–éƒ¨ã‚µã‚¤ãƒˆã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆï¼‰:</h4>
            <ul>
                <li><a href="/redirect?url=https://example.com" class="danger-link">å¤–éƒ¨ã‚µã‚¤ãƒˆ (example.com)</a></li>
                <li><a href="/redirect?url=https://google.com" class="danger-link">å¤–éƒ¨ã‚µã‚¤ãƒˆ (google.com)</a></li>
                <li><a href="/redirect?url=http://malicious-site.com/phishing" class="danger-link">æ‚ªæ„ã®ã‚ã‚‹ã‚µã‚¤ãƒˆï¼ˆãƒ‡ãƒ¢ï¼‰</a></li>
            </ul>
        </div>
    </div>

    <div class="demo-section">
        <h3>ğŸ’¡ æ”»æ’ƒã‚·ãƒŠãƒªã‚ª</h3>
        <p>æ”»æ’ƒè€…ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªURLã‚’ä½œæˆã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¨™ã™ã“ã¨ãŒã§ãã¾ã™ï¼š</p>
        <div class="code-block">
            <pre>https://vulnapp.com/redirect?url=http://evil-site.com/steal-credentials</pre>
        </div>
        <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä¿¡é ¼ã§ãã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆvulnapp.comï¼‰ã‚’è¦‹ã¦å®‰å¿ƒã—ã€ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚</p>
    </div>

    <div class="demo-section">
        <h3>ğŸ› ï¸ æ‰‹å‹•ãƒ†ã‚¹ãƒˆ</h3>
        <form method="GET" action="/redirect" class="test-form">
            <label for="url">ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆURL:</label>
            <input type="text" id="url" name="url" placeholder="https://example.com" style="width: 70%;">
            <button type="submit" class="btn">ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ</button>
        </form>
    </div>

    <div class="demo-section">
        <h3>ğŸ“– æŠ€è¡“çš„ãªèª¬æ˜</h3>
        <div class="code-block">
            <h4>è„†å¼±ãªã‚³ãƒ¼ãƒ‰:</h4>
            <pre>@app.route('/redirect')
def redirect_page():
    url = request.args.get('url', '/')
    return redirect(url)  # æ¤œè¨¼ãªã—ã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ</pre>
        </div>
        <div class="code-block">
            <h4>å®‰å…¨ãªã‚³ãƒ¼ãƒ‰:</h4>
            <pre>@app.route('/redirect')
def redirect_page():
    url = request.args.get('url', '/')
    
    # ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã«ã‚ˆã‚‹æ¤œè¨¼
    allowed_domains = ['vulnapp.com', 'localhost']
    parsed = urlparse(url)
    
    if parsed.netloc and parsed.netloc not in allowed_domains:
        return "Invalid redirect URL", 400
    
    return redirect(url)</pre>
        </div>
        <p><strong>å¯¾ç­–:</strong></p>
        <ul>
            <li>ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆURLã‚’ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã§æ¤œè¨¼</li>
            <li>ç›¸å¯¾ãƒ‘ã‚¹ã®ã¿ã‚’è¨±å¯</li>
            <li>å¤–éƒ¨URLã¸ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã«ã¯è­¦å‘Šã‚’è¡¨ç¤º</li>
        </ul>
    </div>
</div>

<style>
.vuln-demo {
    max-width: 900px;
    margin: 0 auto;
}

.warning-box {
    background-color: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: 5px;
    padding: 15px;
    margin: 20px 0;
}

.demo-section {
    background-color: #f8f9fa;
    border-radius: 5px;
    padding: 20px;
    margin: 20px 0;
}

.link-examples h4 {
    margin-top: 15px;
    margin-bottom: 10px;
}

.link-examples ul {
    list-style: none;
    padding: 0;
}

.link-examples li {
    margin: 10px 0;
}

.safe-link {
    color: #28a745;
    text-decoration: none;
    padding: 8px 15px;
    background-color: #d4edda;
    border-radius: 4px;
    display: inline-block;
}

.safe-link:hover {
    background-color: #c3e6cb;
}

.danger-link {
    color: #dc3545;
    text-decoration: none;
    padding: 8px 15px;
    background-color: #f8d7da;
    border-radius: 4px;
    display: inline-block;
}

.danger-link:hover {
    background-color: #f5c6cb;
}

.test-form {
    display: flex;
    gap: 10px;
    align-items: center;
    flex-wrap: wrap;
}

.test-form label {
    font-weight: bold;
    width: 100%;
}

.test-form input[type="text"] {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
}

.code-block {
    background-color: #fff;
    border-left: 4px solid #007bff;
    padding: 15px;
    margin: 15px 0;
}

.code-block pre {
    background-color: #f4f4f4;
    padding: 10px;
    border-radius: 4px;
    overflow-x: auto;
    font-family: monospace;
    font-size: 14px;
    margin: 10px 0;
}

.code-block ul {
    margin-top: 10px;
}
</style>
{% endblock %}
