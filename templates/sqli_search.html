{% extends "base.html" %}

{% block title %}å•†å“æ¤œç´¢ - SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¢{% endblock %}

{% block content %}
<div class="vuln-demo">
    <h2>ğŸ” å•†å“æ¤œç´¢ (SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¢)</h2>
    
    <div class="warning-box">
        <h3>âš ï¸ è„†å¼±æ€§: SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ (A03:2021)</h3>
        <p>ã“ã®æ¤œç´¢æ©Ÿèƒ½ã¯æ„å›³çš„ã«SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®è„†å¼±æ€§ã‚’å«ã‚“ã§ã„ã¾ã™ã€‚</p>
    </div>

    <div class="demo-section">
        <h3>æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ </h3>
        <form method="GET" action="/product/search" class="search-form">
            <label for="id">å•†å“ID:</label>
            <input type="text" id="id" name="id" value="{{ product_id }}" placeholder="ä¾‹: 1">
            <button type="submit" class="btn">æ¤œç´¢</button>
        </form>
    </div>

    <div class="demo-section">
        <h3>ğŸ’¡ è©¦ã—ã¦ã¿ã‚‹ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰</h3>
        <ul class="payload-list">
            <li><code>1 OR 1=1--</code> - å…¨å•†å“ã‚’è¡¨ç¤º</li>
            <li><code>1 UNION SELECT id, name, 'injected' as description, 0 as price FROM products--</code> - UNIONæ”»æ’ƒ</li>
            <li><code>999 OR 1=1--</code> - å­˜åœ¨ã—ãªã„IDã§ã‚‚å…¨å•†å“è¡¨ç¤º</li>
            <li><code>1; DROP TABLE products--</code> - ç ´å£Šçš„ãªã‚¯ã‚¨ãƒªï¼ˆå®Ÿéš›ã«ã¯å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ï¼‰</li>
        </ul>
    </div>

    {% if error_message %}
    <div class="error-box">
        <h3>ğŸš¨ SQLã‚¨ãƒ©ãƒ¼</h3>
        <pre>{{ error_message }}</pre>
        <p class="info-leak">ğŸ’¡ ã“ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ”»æ’ƒè€…ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹é€ ã®æƒ…å ±ã‚’æ¼æ´©ã•ã›ã¦ã„ã¾ã™</p>
    </div>
    {% endif %}

    {% if products %}
    <div class="result-section">
        <h3>æ¤œç´¢çµæœ ({{ products|length }}ä»¶)</h3>
        <div class="product-grid">
            {% for product in products %}
            <div class="product-card">
                <h4>{{ product['name'] }}</h4>
                <p>{{ product['description'] }}</p>
                <p class="price">Â¥{{ product['price'] }}</p>
                <a href="/product/{{ product['id'] }}" class="btn">è©³ç´°ã‚’è¦‹ã‚‹</a>
            </div>
            {% endfor %}
        </div>
    </div>
    {% elif product_id %}
    <div class="info-box">
        <p>æ¤œç´¢çµæœãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</p>
    </div>
    {% endif %}

    <div class="demo-section">
        <h3>ğŸ“– æŠ€è¡“çš„ãªèª¬æ˜</h3>
        <div class="code-block">
            <h4>è„†å¼±ãªã‚³ãƒ¼ãƒ‰:</h4>
            <pre>query = f"SELECT * FROM products WHERE id = {product_id}"
products = conn.execute(query).fetchall()</pre>
        </div>
        <div class="code-block">
            <h4>å®‰å…¨ãªã‚³ãƒ¼ãƒ‰:</h4>
            <pre>query = "SELECT * FROM products WHERE id = ?"
products = conn.execute(query, (product_id,)).fetchall()</pre>
        </div>
        <p>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã•ã‚ŒãŸã‚¯ã‚¨ãƒªï¼ˆãƒ—ãƒªãƒšã‚¢ãƒ‰ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¡ãƒ³ãƒˆï¼‰ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’é˜²ãã“ã¨ãŒã§ãã¾ã™ã€‚</p>
    </div>
</div>

<style>
.vuln-demo {
    max-width: 900px;
    margin: 0 auto;
}

.warning-box {
    background-color: #fff3cd;
    border: 2px solid #ffc107;
    border-radius: 5px;
    padding: 15px;
    margin: 20px 0;
}

.demo-section {
    background-color: #f8f9fa;
    border-radius: 5px;
    padding: 20px;
    margin: 20px 0;
}

.search-form {
    display: flex;
    gap: 10px;
    align-items: center;
}

.search-form label {
    font-weight: bold;
}

.search-form input[type="text"] {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 16px;
}

.payload-list {
    list-style: none;
    padding: 0;
}

.payload-list li {
    background-color: #fff;
    border-left: 4px solid #007bff;
    padding: 10px;
    margin: 10px 0;
    font-family: monospace;
}

.payload-list code {
    background-color: #f4f4f4;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 14px;
}

.error-box {
    background-color: #f8d7da;
    border: 2px solid #dc3545;
    border-radius: 5px;
    padding: 15px;
    margin: 20px 0;
}

.error-box pre {
    background-color: #fff;
    padding: 10px;
    border-radius: 4px;
    overflow-x: auto;
    font-family: monospace;
    font-size: 14px;
}

.info-leak {
    color: #dc3545;
    font-weight: bold;
    margin-top: 10px;
}

.info-box {
    background-color: #d1ecf1;
    border: 1px solid #bee5eb;
    border-radius: 5px;
    padding: 15px;
    margin: 20px 0;
}

.result-section {
    margin: 20px 0;
}

.code-block {
    background-color: #fff;
    border-left: 4px solid #28a745;
    padding: 15px;
    margin: 15px 0;
}

.code-block pre {
    background-color: #f4f4f4;
    padding: 10px;
    border-radius: 4px;
    overflow-x: auto;
    font-family: monospace;
    font-size: 14px;
    margin: 10px 0;
}

.product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.product-card {
    background-color: #fff;
    border: 1px solid #ddd;
    border-radius: 5px;
    padding: 15px;
    transition: box-shadow 0.3s;
}

.product-card:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.product-card h4 {
    margin-top: 0;
    color: #333;
}

.product-card .price {
    color: #dc3545;
    font-size: 1.2em;
    font-weight: bold;
    margin: 10px 0;
}
</style>
{% endblock %}
