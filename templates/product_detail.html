{% extends "base.html" %}

{% block title %}{{ product.name }} - VulnApp{% endblock %}

{% block content %}
<div class="product-detail">
    <h2>{{ product.name }}</h2>
    <p class="price">Â¥{{ "{:,}".format(product.price) }}</p>
    <p class="description">{{ product.description }}</p>
    <p class="category">ã‚«ãƒ†ã‚´ãƒª: {{ product.category }}</p>
</div>

<hr>

<!-- ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
<div class="reviews-section">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3>ãƒ¬ãƒ“ãƒ¥ãƒ¼ ({{ reviews|length }}ä»¶)</h3>
        <a href="/admin/clear-reviews" style="padding: 8px 16px; background-color: #ffc107; color: #000; text-decoration: none; border-radius: 5px; font-weight: bold; border: 2px solid #ff9800;">ğŸ”§ ãƒ¬ãƒ“ãƒ¥ãƒ¼ç®¡ç†</a>
    </div>
    
    <!-- ğŸš¨ è„†å¼±æ€§3: XSS (Stored) -->
    {% for review in reviews %}
    <div class="review-card">
        <div class="review-header">
            <strong>{{ review.author }}</strong>
            <span class="rating">è©•ä¾¡: {{ 'â˜…' * review.rating }}{{ 'â˜†' * (5 - review.rating) }}</span>
        </div>
        <!-- safeãƒ•ã‚£ãƒ«ã‚¿ã§æ„å›³çš„ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚’ç„¡åŠ¹åŒ– -->
        <p class="review-comment">{{ review.comment | safe }}</p>
        <small class="review-date">{{ review.created_at }}</small>
    </div>
    {% else %}
    <p>ã¾ã ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>
    {% endfor %}
</div>

<hr>

<!-- ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆå•†å“ID=1ã®ã¿è¡¨ç¤ºï¼‰ -->
{% if product.id == 1 %}
<div class="review-form">
    <h3>ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æŠ•ç¨¿</h3>
    <form method="POST" action="/product/{{ product.id }}/review">
        <div class="form-group">
            <label for="author">åå‰:</label>
            <input type="text" id="author" name="author" placeholder="åŒ¿å" maxlength="50">
        </div>
        
        <div class="form-group">
            <label for="rating">è©•ä¾¡:</label>
            <select id="rating" name="rating">
                <option value="5">â˜…â˜…â˜…â˜…â˜… (5)</option>
                <option value="4">â˜…â˜…â˜…â˜…â˜† (4)</option>
                <option value="3">â˜…â˜…â˜…â˜†â˜† (3)</option>
                <option value="2">â˜…â˜…â˜†â˜†â˜† (2)</option>
                <option value="1">â˜…â˜†â˜†â˜†â˜† (1)</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="comment">ã‚³ãƒ¡ãƒ³ãƒˆ:</label>
            <textarea id="comment" name="comment" rows="4" required placeholder="å•†å“ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."></textarea>
        </div>
        
        <button type="submit" class="btn">æŠ•ç¨¿ã™ã‚‹</button>
    </form>
</div>

<!-- è„†å¼±æ€§ã®ãƒ’ãƒ³ãƒˆ -->
<div class="hint-box">
    <h4>ğŸ’¡ ãƒ†ã‚¹ãƒˆã®ãƒ’ãƒ³ãƒˆ</h4>
    <ul>
        <li><strong>XSS (Stored):</strong> ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã« <code>&lt;script&gt;alert('Stored XSS')&lt;/script&gt;</code> ã‚’å…¥åŠ›ã—ã¦ã¿ã¦ãã ã•ã„</li>
        <li><strong>HTMLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³:</strong> <code>&lt;h1&gt;ãƒ†ã‚¹ãƒˆ&lt;/h1&gt;</code> ã‚„ <code>&lt;img src=x onerror=alert('XSS')&gt;</code> ã‚‚è©¦ã›ã¾ã™</li>
    </ul>
</div>

{% else %}
<div class="info-box" style="background-color: #e3f2fd; border-left: 4px solid #2196f3; padding: 1rem; margin: 2rem 0; border-radius: 5px;">
    <h4>â„¹ï¸ ã“ã®å•†å“ã¯ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ã§ãã¾ã›ã‚“</h4>
    <p>ãƒ¬ãƒ“ãƒ¥ãƒ¼æŠ•ç¨¿ã®ãƒ†ã‚¹ãƒˆã¯ <a href="/product/1">ãƒãƒ¼ãƒˆãƒ‘ã‚½ã‚³ãƒ³ï¼ˆå•†å“ID: 1ï¼‰</a> ã§ãŠè©¦ã—ãã ã•ã„ã€‚</p>
</div>
{% endif %}

<p><a href="/products">â† å•†å“ä¸€è¦§ã«æˆ»ã‚‹</a></p>
{% endblock %}
