{% extends "base.html" %}

{% block title %}Guestbook - VulnApp{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>ğŸ“– Guestbook</h1>
    <p class="lead">Leave your message here!</p>

    <!-- è„†å¼±æ€§è­¦å‘Š -->
    <div class="alert alert-danger" role="alert">
        <h4 class="alert-heading">âš ï¸ Stored XSS Vulnerability</h4>
        <p>ã“ã®ã‚²ã‚¹ãƒˆãƒ–ãƒƒã‚¯ã¯<strong>æ„å›³çš„ã«è„†å¼±</strong>ã§ã™ï¼š</p>
        <ul class="mb-0">
            <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®<strong>ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†ãªã—</strong></li>
            <li>æŠ•ç¨¿ã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆã¯<strong>ãã®ã¾ã¾HTMLã¨ã—ã¦è¡¨ç¤º</strong>ã•ã‚Œã‚‹</li>
            <li>XSSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãŒ<strong>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜</strong>ã•ã‚Œã€å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å½±éŸ¿</li>
        </ul>
    </div>

    <!-- æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">âœï¸ Post a Message</h5>
        </div>
        <div class="card-body">
            <form method="POST" action="/guestbook">
                <div class="mb-3">
                    <label for="name" class="form-label">Name:</label>
                    <input type="text" class="form-control" id="name" name="name" 
                           placeholder="Your name" required>
                </div>
                <div class="mb-3">
                    <label for="comment" class="form-label">Message:</label>
                    <textarea class="form-control" id="comment" name="comment" 
                              rows="3" placeholder="Your message..." required></textarea>
                    <div class="form-text">
                        âš ï¸ Warning: Input is NOT sanitized. XSS payloads will be executed.
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Post Message</button>
            </form>
        </div>
    </div>

    <!-- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¸€è¦§ -->
    <div class="card">
        <div class="card-header bg-secondary text-white">
            <h5 class="mb-0">ğŸ’¬ Messages ({{ entries|length }})</h5>
        </div>
        <div class="card-body">
            {% if entries %}
                {% for entry in entries %}
                <div class="border-bottom pb-3 mb-3">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <strong>{{ entry.name }}</strong>
                            <small class="text-muted">{{ entry.created_at }}</small>
                        </div>
                        <span class="badge bg-danger">ID: {{ entry.id }}</span>
                    </div>
                    <div class="mt-2">
                        <!-- æ„å›³çš„ãªè„†å¼±æ€§: |safe ãƒ•ã‚£ãƒ«ã‚¿ã§XSSå¯èƒ½ -->
                        {{ entry.comment | safe }}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <p class="text-muted">No messages yet. Be the first to post!</p>
            {% endif %}
        </div>
    </div>

    <!-- ç®¡ç†è€…ç”¨ï¼šã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ -->
    <div class="mt-3">
        <form method="POST" action="/guestbook/clear" 
              onsubmit="return confirm('Are you sure you want to clear all messages?');">
            <button type="submit" class="btn btn-danger btn-sm">
                ğŸ—‘ï¸ Clear All Messages (Admin)
            </button>
        </form>
    </div>

    <!-- æ”»æ’ƒä¾‹ -->
    <div class="card mt-4">
        <div class="card-header bg-warning">
            <h5 class="mb-0">ğŸ¯ Attack Examples</h5>
        </div>
        <div class="card-body">
            <h6>Test Payloads for Stored XSS:</h6>
            <pre class="bg-light p-3"><code>&lt;script&gt;alert('XSS')&lt;/script&gt;
&lt;img src=x onerror="alert('XSS')"&gt;
&lt;svg/onload=alert('XSS')&gt;
&lt;iframe src="javascript:alert('XSS')"&gt;&lt;/iframe&gt;</code></pre>

            <h6 class="mt-3">curl command example:</h6>
            <pre class="bg-light p-3"><code>curl -X POST http://18.179.9.154/guestbook \
  -d "name=Hacker&comment=&lt;script&gt;alert('Stored XSS')&lt;/script&gt;"</code></pre>
        </div>
    </div>

    <div class="mt-4">
        <a href="/" class="btn btn-secondary">â† Back to Home</a>
    </div>
</div>
{% endblock %}
